ScriptGuard Smoke Test Instructions
====================================

Objective: Verify all major features work correctly

Prerequisites:
- Python 3 installed
- Chrome browser
- ScriptGuard extension loaded (unpacked)

---

Step 1: Start Demo Server
1. Open terminal in scriptguard/ directory
2. Run: python3 demo/server.py
3. Verify output shows "Starting ScriptGuard demo server on http://localhost:8000"

Step 2: Load Extension
1. Open Chrome
2. Go to chrome://extensions/
3. Enable "Developer mode" (top-right toggle)
4. Click "Load unpacked"
5. Select the scriptguard/ folder
6. Verify ScriptGuard appears in extensions list

Step 3: Open Demo Page
1. Open new tab
2. Navigate to http://localhost:8000/news_demo.html
3. Verify page loads with "ScriptGuard Demo - News Site" header

Step 4: Test Default Behavior
1. Open Chrome DevTools Console (F12)
2. Observe console logs:
   - "Demo analytics script loaded"
   - "Demo miner script loaded"  
   - "Social widget script loaded"
   - ScriptGuard logs showing allowed actions
3. Wait 10 seconds, verify analytics sends periodic pings
4. Verify miner completes after ~2 seconds
5. Verify social widget shows comment

Step 5: Test Network Blocking
1. Click ScriptGuard extension icon
2. In popup, toggle "Network" OFF
3. Click "Save Policy"
4. In demo page, click "Test Fetch Analytics" button
5. Verify:
   - Console shows "Fetch blocked by ScriptGuard"
   - Popup logs show "fetch" type with "blocked" decision
6. Wait for next analytics auto-ping (should fail)
7. Click "Test XHR Request" button (should fail)

Step 6: Test Storage Blocking
1. In popup, turn Network back ON, toggle "Storage" OFF
2. Save policy
3. On demo page, click "Test LocalStorage" button
4. Verify:
   - Console shows storage blocked log
   - No error in demo page (fails silently)
5. Check social widget - new comments won't save

Step 7: Test DOM Blocking
1. In popup, set "DOM Mode" to "None"
2. Save policy
3. On demo page, click "Test DOM Injection" button
4. Verify:
   - No new DOM element appears
   - Log shows "dom-mod" blocked
5. Set DOM Mode to "Read-only" and test again (should also block)

Step 8: Test Allow Once
1. In popup, ensure Network is OFF
2. Click "Allow once (5 min)"
3. On demo page, click "Test Fetch Analytics"
4. Verify fetch succeeds (temporarily allowed)
5. Wait 6 minutes, test again (should be blocked)

Step 9: Test Options Dashboard
1. Click "Dashboard" button in popup
2. Verify dashboard opens in new tab
3. Check "Policies" section shows current policies
4. Click "Export Policies" (downloads JSON)
5. In "Logs" section:
   - Search for "blocked" (should filter logs)
   - Click "Clear Logs" and confirm
   - Verify logs disappear
6. Close dashboard tab

Step 10: Test Cookie Blocking
1. In popup, toggle "Cookies" OFF
2. Save policy
3. In Chrome DevTools Console, run:
   document.cookie = "test=blocked";
4. Verify ScriptGuard logs show cookie blocked

Step 11: Cleanup
1. Stop demo server (Ctrl+C in terminal)
2. In popup, reset all toggles to ON, DOM to "Full"
3. Save policy
4. Reload demo page to verify everything works again

Expected Results:
- All blocking features work as described
- Logs are created for each blocked action
- Allow once temporarily permits actions
- Dashboard shows and manages logs/policies
- No page crashes or errors break the demo

Common Issues:
- CORS errors: Ensure server is running and returns CORS headers
- Extension not loading: Check for errors in chrome://extensions/
- Policies not applying: Reload the demo page after changing policies
- Logs not appearing: Check background.js for errors in extension service worker